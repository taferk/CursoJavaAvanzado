<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GuÃ­a del ejemplo del tema 4: AplicaciÃ³n Web con JSP</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

  <script>
    function toggleSection(id) {
      const el = document.getElementById(id);
      el.classList.toggle('is-hidden');
    }
  </script>
</head>
<body>
<section class="hero is-info">
  <div class="hero-body">
    <div class="container is-vcentered has-text-centered">
          <figure class="image is-96x96 is-pulled-left">
            <img src="images/logo_cja.png" alt="Logo del Curso Java Avanzado">
          </figure>
          <h1 class="title">Curso de Java Avanzado</h1>
          <h2 class="subtitle">Domina las tecnologÃ­as modernas con Java</h2>
    </div>
  </div>
</section>
 <section class="section">
    <div class="container">

  <h1 class="title">ğŸ§­ GuÃ­a del ejemplo del tema 4: <code>AplicaciÃ³n Web con JSP</code></h1>
  <p class="subtitle">Ejemplo: <strong>AppWebJSP</strong></p>     

  <div class="box">
    <button class="button is-info is-light" onclick="toggleSection('librerias')">ğŸ“¦ LibrerÃ­as utilizadas en el ejemplo</button>
	<div id="librerias" class="content is-hidden mt-3">
    <ul>
      <li><strong>jakarta.servlet.*</strong>: Para manejar peticiones HTTP y despachar vistas.</li>
      <li><strong>java.text.SimpleDateFormat</strong>: Para convertir cadenas en fechas.</li>
      <li><strong>java.util.Date</strong>: Para representar fechas de nacimiento.</li>
      <li><strong>dao.*</strong>: Acceso a datos (ClienteDao).</li>
      <li><strong>model.*</strong>: Modelo de datos (Cliente).</li>
    </ul>
	</div>
  </div>

  <div class="box">
    <button class="button is-info is-light" onclick="toggleSection('estructura')">ğŸ§© Estructura del ejemplo</button>
	<div id="estructura" class="content is-hidden mt-3">
    <pre>
AppWeb/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ ClienteController.java
â”œâ”€â”€ dao/
â”‚   â””â”€â”€ ClienteDao.java
â”œâ”€â”€ model/
â”‚   â””â”€â”€ Cliente.java
â”œâ”€â”€ vista/
â”‚   â”œâ”€â”€ cliente.jsp
â”‚   â””â”€â”€ listadoClientes.jsp
    </pre>
	</div>
  </div>

  <div class="box">
    <button class="button is-info is-light" onclick="toggleSection('indicaciones')">ğŸ”„ Indicaciones generales</button>
	<div id="indicaciones" class="content is-hidden mt-3">
		<ul>
		  <li><strong>DefiniciÃ³n del Servlet:</strong> Extiende HttpServlet para manejar peticiones HTTP.</li>
		  <li><strong>Constantes de vista:</strong> Define rutas para JSP: <code>/cliente.jsp</code> y <code>/listadoClientes.jsp</code>.</li>
		  <li><strong>InicializaciÃ³n:</strong> Se instancia ClienteDao para acceso a datos.</li>
		  <li><strong>doGet:</strong> Gestiona acciones como borrar, editar y listar clientes.</li>
		  <li><strong>doPost:</strong> Procesa formularios para insertar o actualizar clientes.</li>
		  <li><strong>ConversiÃ³n de fecha:</strong> Usa SimpleDateFormat para convertir cadenas a Date.</li>
		  <li><strong>Encapsulamiento:</strong> Los datos del formulario se encapsulan en un objeto Cliente.</li>
		  <li><strong>Despacho de vistas:</strong> Se usa RequestDispatcher para redirigir a la vista correspondiente.</li>
		</ul>
	</div>
  </div>

<div class="box">
  <button class="button is-info is-light" onclick="toggleSection('ejemplos')">ğŸ§ª Ejemplos de cÃ³digo</button>
	<div id="ejemplos" class="content is-hidden mt-3">

  <h3>1. DefiniciÃ³n del Servlet</h3>
  <pre><code>public class ClienteController extends HttpServlet {
    private static final long serialVersionUID = 1L;
    private static String INSERTAR_O_EDITAR = "/cliente.jsp";
    private static String LISTADO = "/listadoClientes.jsp";
    private ClienteDao dao;

    public ClienteController() {
        super();
        dao = new ClienteDao();
    }
}</code></pre>

  <h3>2. Manejo de peticiones GET (doGet)</h3>
  <pre><code>protected void doGet(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    String action = request.getParameter("action");
    String urlVista = "";

    switch (action) {
        case "borrar":
            int clienteId = Integer.parseInt(request.getParameter("clienteId"));
            dao.borrarCliente(clienteId);
            request.setAttribute("clientes", dao.obtenerClientes());
            urlVista = LISTADO;
            break;

        case "editar":
            clienteId = Integer.parseInt(request.getParameter("clienteId"));
            Cliente cliente = dao.obtenerClienteById(clienteId);
            request.setAttribute("cliente", cliente);
            urlVista = INSERTAR_O_EDITAR;
            break;

        case "listado":
            request.setAttribute("clientes", dao.obtenerClientes());
            urlVista = LISTADO;
            break;

        default:
            urlVista = INSERTAR_O_EDITAR;
    }

    RequestDispatcher vista = request.getRequestDispatcher(urlVista);
    vista.forward(request, response);
}</code></pre>

  <h3>3. Manejo de peticiones POST (doPost)</h3>
  <pre><code>protected void doPost(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    request.setCharacterEncoding("ISO-8859-1");

    String strClienteId = request.getParameter("clienteId");
    String strNombre = request.getParameter("nombre");
    String strApellidos = request.getParameter("apellidos");
    String strFechaNacimiento = request.getParameter("fechaNacimiento");
    String strNumPedido = request.getParameter("numPedidos");

    try {
        Cliente cliente = new Cliente();
        cliente.setNombre(strNombre);
        cliente.setApellidos(strApellidos);
        Date fecha = new SimpleDateFormat("dd/MM/yyyy").parse(strFechaNacimiento);
        cliente.setFechaNacimiento(fecha);
        cliente.setNumPedidos(Integer.parseInt(strNumPedido));

        if (strClienteId == null || strClienteId.isEmpty()) {
            dao.insertarCliente(cliente);
        } else {
            cliente.setId(Integer.parseInt(strClienteId));
            dao.actualizarCliente(cliente);
        }
    } catch (ParseException e) {
        e.printStackTrace();
    }

    request.setAttribute("clientes", dao.obtenerClientes());
    RequestDispatcher vista = request.getRequestDispatcher(LISTADO);
    vista.forward(request, response);
}</code></pre>

  <h3>4. ConversiÃ³n de fecha</h3>
  <pre><code>Date fecha = new SimpleDateFormat("dd/MM/yyyy").parse(strFechaNacimiento);
cliente.setFechaNacimiento(fecha);</code></pre>

  <h3>5. RedirecciÃ³n a vistas</h3>
  <pre><code>RequestDispatcher vista = request.getRequestDispatcher(urlVista);
vista.forward(request, response);</code></pre>
</div>
</div>

<div class="box">
    <button class="button is-info is-light" onclick="toggleSection('metodo-get')">ğŸ§  ExplicaciÃ³n detallada del mÃ©todo <code>doGet</code></button>
	<div id="metodo-get" class="content is-hidden mt-3">
	  <p>El mÃ©todo <code>doGet</code> del archivo <code>ClienteController.java</code> se encarga de gestionar las peticiones HTTP GET. Su funciÃ³n principal es decidir quÃ© vista mostrar al usuario segÃºn la acciÃ³n solicitada en la URL.</p>

	  <h3>ğŸ“Œ PropÃ³sito general</h3>
	  <ul>
		<li>Mostrar el formulario de ediciÃ³n o inserciÃ³n de clientes.</li>
		<li>Listar todos los clientes registrados.</li>
		<li>Eliminar un cliente especÃ­fico.</li>
	  </ul>

	  <h3>ğŸ§© Estructura del mÃ©todo</h3>
	  <pre><code>protected void doGet(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		String action = request.getParameter("action");
		String urlVista = "";

		switch (action) {
			case "borrar":
				// Eliminar cliente
				break;
			case "editar":
				// Cargar cliente para ediciÃ³n
				break;
			case "listado":
				// Mostrar listado de clientes
				break;
			default:
				// Mostrar formulario vacÃ­o
		}

		RequestDispatcher vista = request.getRequestDispatcher(urlVista);
		vista.forward(request, response);
	}</code></pre>

	  <h3>ğŸ” Detalle de cada caso</h3>

	  <h4>ğŸ—‘ï¸ <code>borrar</code></h4>
	  <ul>
		<li>Obtiene el <code>clienteId</code> desde la URL.</li>
		<li>Llama a <code>dao.borrarCliente(clienteId)</code> para eliminarlo.</li>
		<li>Actualiza la lista de clientes y redirige a <code>listadoClientes.jsp</code>.</li>
	  </ul>

	  <h4>âœï¸ <code>editar</code></h4>
	  <ul>
		<li>Obtiene el cliente por su ID.</li>
		<li>EnvÃ­a el objeto <code>Cliente</code> como atributo a <code>cliente.jsp</code>.</li>
		<li>La vista mostrarÃ¡ el formulario con los datos precargados.</li>
	  </ul>

	  <h4>ğŸ“‹ <code>listado</code></h4>
	  <ul>
		<li>Obtiene todos los clientes desde el DAO.</li>
		<li>Redirige a la vista <code>listadoClientes.jsp</code>.</li>
	  </ul>

	  <h4>â• <code>default</code></h4>
	  <ul>
		<li>Si no se especifica ninguna acciÃ³n, se muestra el formulario vacÃ­o para insertar un nuevo cliente.</li>
	  </ul>

	  <h3>ğŸš€ Despacho de la vista</h3>
	  <p>Se utiliza <code>RequestDispatcher</code> para redirigir la peticiÃ³n a la vista correspondiente sin cambiar la URL del navegador:</p>
	  <pre><code>RequestDispatcher vista = request.getRequestDispatcher(urlVista);
	vista.forward(request, response);</code></pre>

	  <h3>ğŸ§  Conceptos clave</h3>
	  <ul>
		<li><strong>Controlador MVC:</strong> Este mÃ©todo actÃºa como el controlador que decide quÃ© vista mostrar y quÃ© datos enviar.</li>
		<li><strong>SeparaciÃ³n de responsabilidades:</strong> No contiene lÃ³gica de negocio ni presentaciÃ³n, solo coordinaciÃ³n.</li>
		<li><strong>ReutilizaciÃ³n de vistas:</strong> Tanto inserciÃ³n como ediciÃ³n usan la misma vista <code>cliente.jsp</code>.</li>
	  </ul>
	</div>
</div>

<div class="box">
    <button class="button is-info is-light" onclick="toggleSection('metodo-post')">ğŸ“¨ ExplicaciÃ³n detallada del mÃ©todo <code>doPost</code></button>
	<div id="metodo-post" class="content is-hidden mt-3">
	  <p>El mÃ©todo <code>doPost</code> se encarga de procesar los datos enviados desde el formulario HTML mediante una peticiÃ³n HTTP POST. En este ejemplo, se utiliza para insertar un nuevo cliente o actualizar uno existente.</p>

	  <h3>ğŸ“Œ PropÃ³sito general</h3>
	  <ul>
		<li>Recoger los datos del formulario enviado por el usuario.</li>
		<li>Convertir los datos en un objeto <code>Cliente</code>.</li>
		<li>Insertar o actualizar el cliente en la base de datos.</li>
		<li>Redirigir a la vista de listado de clientes.</li>
	  </ul>

	  <h3>ğŸ§© Estructura del mÃ©todo</h3>
	  <pre><code>protected void doPost(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		request.setCharacterEncoding("ISO-8859-1");

		String strClienteId = request.getParameter("clienteId");
		String strNombre = request.getParameter("nombre");
		String strApellidos = request.getParameter("apellidos");
		String strFechaNacimiento = request.getParameter("fechaNacimiento");
		String strNumPedido = request.getParameter("numPedidos");

		try {
			Cliente cliente = new Cliente();
			cliente.setNombre(strNombre);
			cliente.setApellidos(strApellidos);
			Date fecha = new SimpleDateFormat("dd/MM/yyyy").parse(strFechaNacimiento);
			cliente.setFechaNacimiento(fecha);
			cliente.setNumPedidos(Integer.parseInt(strNumPedido));

			if (strClienteId == null || strClienteId.isEmpty()) {
				dao.insertarCliente(cliente);
			} else {
				cliente.setId(Integer.parseInt(strClienteId));
				dao.actualizarCliente(cliente);
			}
		} catch (ParseException e) {
			e.printStackTrace();
		}

		request.setAttribute("clientes", dao.obtenerClientes());
		RequestDispatcher vista = request.getRequestDispatcher(LISTADO);
		vista.forward(request, response);
	}</code></pre>

	  <h3>ğŸ” Paso a paso</h3>

	  <h4>ğŸ”¤ CodificaciÃ³n de caracteres</h4>
	  <p>Se establece <code>ISO-8859-1</code> para evitar problemas con caracteres especiales como tildes o eÃ±es.</p>

	  <h4>ğŸ“¥ Lectura de parÃ¡metros</h4>
	  <ul>
		<li>Se extraen los valores del formulario usando <code>request.getParameter()</code>.</li>
		<li>Los datos incluyen nombre, apellidos, fecha de nacimiento, nÃºmero de pedidos y (opcionalmente) el ID del cliente.</li>
	  </ul>

	  <h4>ğŸ§± ConstrucciÃ³n del objeto <code>Cliente</code></h4>
	  <ul>
		<li>Se crea una instancia de <code>Cliente</code>.</li>
		<li>Se asignan los valores obtenidos del formulario.</li>
		<li>La fecha se convierte usando <code>SimpleDateFormat</code>.</li>
	  </ul>

	  <h4>ğŸ”„ InserciÃ³n o actualizaciÃ³n</h4>
	  <ul>
		<li>Si el campo <code>clienteId</code> estÃ¡ vacÃ­o, se inserta un nuevo cliente.</li>
		<li>Si contiene un valor, se actualiza el cliente existente con ese ID.</li>
	  </ul>

	  <h4>ğŸ“‹ RedirecciÃ³n a la vista</h4>
	  <ul>
		<li>Se actualiza la lista de clientes.</li>
		<li>Se redirige a <code>listadoClientes.jsp</code> usando <code>RequestDispatcher</code>.</li>
	  </ul>

	  <h3>ğŸ§  Conceptos clave</h3>
	  <ul>
		<li><strong>ValidaciÃ³n bÃ¡sica:</strong> Se verifica si el ID estÃ¡ vacÃ­o para decidir entre insertar o actualizar.</li>
		<li><strong>ConversiÃ³n de tipos:</strong> Se convierte la fecha y el nÃºmero de pedidos a sus tipos correspondientes.</li>
		<li><strong>Control de errores:</strong> Se captura <code>ParseException</code> por si la fecha no tiene el formato esperado.</li>
		<li><strong>ReutilizaciÃ³n de vistas:</strong> Tanto inserciÃ³n como ediciÃ³n redirigen al listado final.</li>
	  </ul>
	</div>
</div>


<div class="box">
  <button class="button is-info is-light" onclick="toggleSection('conceptos')">ğŸ”— Conceptos de programaciÃ³n aplicados</button>
	<div id="conceptos" class="content is-hidden mt-3">
	  <h3>1. ğŸ§± ProgramaciÃ³n orientada a objetos (POO)</h3>
	  <ul>
		<li><strong>Encapsulamiento:</strong> El objeto <code>Cliente</code> agrupa atributos y mÃ©todos relacionados.</li>
		<li><strong>AbstracciÃ³n:</strong> El controlador usa <code>ClienteDao</code> sin conocer su implementaciÃ³n interna.</li>
		<li><strong>Modularidad:</strong> Cada clase tiene una responsabilidad clara y separada.</li>
	  </ul>

	  <h3>2. ğŸ” PatrÃ³n MVC (Modelo-Vista-Controlador)</h3>
	  <ul>
		<li><strong>Modelo:</strong> <code>Cliente.java</code> representa los datos del cliente.</li>
		<li><strong>Vista:</strong> <code>cliente.jsp</code> y <code>listadoClientes.jsp</code> muestran la interfaz al usuario.</li>
		<li><strong>Controlador:</strong> <code>ClienteController.java</code> gestiona el flujo entre modelo y vista.</li>
	  </ul>

	  <h3>3. ğŸ§  Principios SOLID</h3>
	  <ul>
		<li><strong>S - Responsabilidad Ãºnica:</strong> Cada clase tiene una Ãºnica razÃ³n para cambiar.</li>
		<li><strong>D - InversiÃ³n de dependencias:</strong> Se puede aplicar inyecciÃ³n de dependencias para desacoplar componentes.</li>
	  </ul>

	  <h3>4. ğŸ§® Manejo de errores y validaciÃ³n</h3>
	  <ul>
		<li><strong>Control de errores:</strong> Uso de <code>try-catch</code> para capturar <code>ParseException</code>.</li>
		<li><strong>ValidaciÃ³n:</strong> VerificaciÃ³n de campos como <code>clienteId</code> para decidir entre insertar o actualizar.</li>
	  </ul>

	  <h3>5. ğŸŒ ComunicaciÃ³n cliente-servidor</h3>
	  <ul>
		<li><strong>Servlet:</strong> ActÃºa como intermediario entre el navegador y el servidor.</li>
		<li><strong>HTTP:</strong> Manejo de mÃ©todos <code>GET</code> y <code>POST</code> para procesar peticiones.</li>
	  </ul>

	  <h3>6. ğŸ“¦ ReutilizaciÃ³n y mantenimiento</h3>
	  <ul>
		<li><strong>Constantes reutilizables:</strong> Como <code>INSERTAR_O_EDITAR</code> y <code>LISTADO</code> para rutas de vistas.</li>
		<li><strong>SeparaciÃ³n de capas:</strong> Facilita pruebas unitarias y mantenimiento del cÃ³digo.</li>
	  </ul>
	</div>
  </div>
  
  <div class="box">
	<button class="button is-info is-light" onclick="toggleSection('tecnicos')">ğŸ§  Detalles tÃ©cnicos adicionales</button>
	<div id="tecnicos" class="content is-hidden mt-3">
		<ul>
		  <li><strong>CodificaciÃ³n:</strong> Se establece <code>ISO-8859-1</code> para evitar problemas con caracteres especiales.</li>
		  <li><strong>Control de errores:</strong> Se captura <code>ParseException</code> al convertir fechas.</li>
		  <li><strong>ValidaciÃ³n:</strong> Se verifica si <code>clienteId</code> estÃ¡ vacÃ­o para decidir entre insertar o actualizar.</li>
		  <li><strong>ReutilizaciÃ³n de vistas:</strong> Tanto inserciÃ³n como ediciÃ³n usan la misma vista JSP.</li>
		</ul>
	</div>
  </div>

  <div class="box">
    	<button class="button is-info is-light" onclick="toggleSection('alternativas')">ğŸŒ Alternativas en Java para desarrollo de aplicaciones web con MVC</button>
	<div id="alternativas" class="content is-hidden mt-3">
    <ul>
      <li><strong>Spring MVC:</strong> Framework moderno y ampliamente adoptado.</li>
      <li><strong>Struts:</strong> ClÃ¡sico pero aÃºn funcional en entornos legacy.</li>
      <li><strong>JSF:</strong> Ideal para aplicaciones empresariales con componentes reutilizables.</li>
      <li><strong>Vaadin:</strong> UI rica con Java puro, sin necesidad de HTML/CSS/JS.</li>
    </ul>
  </div>
    </div>
</div>
</section>
</body>
</html>
