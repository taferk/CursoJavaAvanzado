<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Guía del ejemplo del tema 4: Aplicación Web con JSP</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

  <script>
    function toggleSection(id) {
      const el = document.getElementById(id);
      el.classList.toggle('is-hidden');
    }
  </script>
</head>
<body>
<section class="hero is-info">
  <div class="hero-body">
    <div class="container is-vcentered has-text-centered">
          <figure class="image is-96x96 is-pulled-left">
            <img src="images/logo_cja.png" alt="Logo del Curso Java Avanzado">
          </figure>
          <h1 class="title">Curso de Java Avanzado</h1>
          <h2 class="subtitle">Domina las tecnologías modernas con Java</h2>
    </div>
  </div>
</section>
 <section class="section">
    <div class="container">

  <h1 class="title">🧭 Guía del ejemplo del tema 4: <code>Aplicación Web con JSP</code></h1>
  <p class="subtitle">Ejemplo: <strong>AppWebJSP</strong></p>     

  <div class="box">
    <button class="button is-info is-light" onclick="toggleSection('librerias')">📦 Librerías utilizadas en el ejemplo</button>
	<div id="librerias" class="content is-hidden mt-3">
    <ul>
      <li><strong>jakarta.servlet.*</strong>: Para manejar peticiones HTTP y despachar vistas.</li>
      <li><strong>java.text.SimpleDateFormat</strong>: Para convertir cadenas en fechas.</li>
      <li><strong>java.util.Date</strong>: Para representar fechas de nacimiento.</li>
      <li><strong>dao.*</strong>: Acceso a datos (ClienteDao).</li>
      <li><strong>model.*</strong>: Modelo de datos (Cliente).</li>
    </ul>
	</div>
  </div>

  <div class="box">
    <button class="button is-info is-light" onclick="toggleSection('estructura')">🧩 Estructura del ejemplo</button>
	<div id="estructura" class="content is-hidden mt-3">
    <pre>
AppWeb/
├── controller/
│   └── ClienteController.java
├── dao/
│   └── ClienteDao.java
├── model/
│   └── Cliente.java
├── vista/
│   ├── cliente.jsp
│   └── listadoClientes.jsp
    </pre>
	</div>
  </div>

  <div class="box">
    <button class="button is-info is-light" onclick="toggleSection('indicaciones')">🔄 Indicaciones generales</button>
	<div id="indicaciones" class="content is-hidden mt-3">
		<ul>
		  <li><strong>Definición del Servlet:</strong> Extiende HttpServlet para manejar peticiones HTTP.</li>
		  <li><strong>Constantes de vista:</strong> Define rutas para JSP: <code>/cliente.jsp</code> y <code>/listadoClientes.jsp</code>.</li>
		  <li><strong>Inicialización:</strong> Se instancia ClienteDao para acceso a datos.</li>
		  <li><strong>doGet:</strong> Gestiona acciones como borrar, editar y listar clientes.</li>
		  <li><strong>doPost:</strong> Procesa formularios para insertar o actualizar clientes.</li>
		  <li><strong>Conversión de fecha:</strong> Usa SimpleDateFormat para convertir cadenas a Date.</li>
		  <li><strong>Encapsulamiento:</strong> Los datos del formulario se encapsulan en un objeto Cliente.</li>
		  <li><strong>Despacho de vistas:</strong> Se usa RequestDispatcher para redirigir a la vista correspondiente.</li>
		</ul>
	</div>
  </div>

<div class="box">
  <button class="button is-info is-light" onclick="toggleSection('ejemplos')">🧪 Ejemplos de código</button>
	<div id="ejemplos" class="content is-hidden mt-3">

  <h3>1. Definición del Servlet</h3>
  <pre><code>public class ClienteController extends HttpServlet {
    private static final long serialVersionUID = 1L;
    private static String INSERTAR_O_EDITAR = "/cliente.jsp";
    private static String LISTADO = "/listadoClientes.jsp";
    private ClienteDao dao;

    public ClienteController() {
        super();
        dao = new ClienteDao();
    }
}</code></pre>

  <h3>2. Manejo de peticiones GET (doGet)</h3>
  <pre><code>protected void doGet(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    String action = request.getParameter("action");
    String urlVista = "";

    switch (action) {
        case "borrar":
            int clienteId = Integer.parseInt(request.getParameter("clienteId"));
            dao.borrarCliente(clienteId);
            request.setAttribute("clientes", dao.obtenerClientes());
            urlVista = LISTADO;
            break;

        case "editar":
            clienteId = Integer.parseInt(request.getParameter("clienteId"));
            Cliente cliente = dao.obtenerClienteById(clienteId);
            request.setAttribute("cliente", cliente);
            urlVista = INSERTAR_O_EDITAR;
            break;

        case "listado":
            request.setAttribute("clientes", dao.obtenerClientes());
            urlVista = LISTADO;
            break;

        default:
            urlVista = INSERTAR_O_EDITAR;
    }

    RequestDispatcher vista = request.getRequestDispatcher(urlVista);
    vista.forward(request, response);
}</code></pre>

  <h3>3. Manejo de peticiones POST (doPost)</h3>
  <pre><code>protected void doPost(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    request.setCharacterEncoding("ISO-8859-1");

    String strClienteId = request.getParameter("clienteId");
    String strNombre = request.getParameter("nombre");
    String strApellidos = request.getParameter("apellidos");
    String strFechaNacimiento = request.getParameter("fechaNacimiento");
    String strNumPedido = request.getParameter("numPedidos");

    try {
        Cliente cliente = new Cliente();
        cliente.setNombre(strNombre);
        cliente.setApellidos(strApellidos);
        Date fecha = new SimpleDateFormat("dd/MM/yyyy").parse(strFechaNacimiento);
        cliente.setFechaNacimiento(fecha);
        cliente.setNumPedidos(Integer.parseInt(strNumPedido));

        if (strClienteId == null || strClienteId.isEmpty()) {
            dao.insertarCliente(cliente);
        } else {
            cliente.setId(Integer.parseInt(strClienteId));
            dao.actualizarCliente(cliente);
        }
    } catch (ParseException e) {
        e.printStackTrace();
    }

    request.setAttribute("clientes", dao.obtenerClientes());
    RequestDispatcher vista = request.getRequestDispatcher(LISTADO);
    vista.forward(request, response);
}</code></pre>

  <h3>4. Conversión de fecha</h3>
  <pre><code>Date fecha = new SimpleDateFormat("dd/MM/yyyy").parse(strFechaNacimiento);
cliente.setFechaNacimiento(fecha);</code></pre>

  <h3>5. Redirección a vistas</h3>
  <pre><code>RequestDispatcher vista = request.getRequestDispatcher(urlVista);
vista.forward(request, response);</code></pre>
</div>
</div>

<div class="box">
    <button class="button is-info is-light" onclick="toggleSection('metodo-get')">🧠 Explicación detallada del método <code>doGet</code></button>
	<div id="metodo-get" class="content is-hidden mt-3">
	  <p>El método <code>doGet</code> del archivo <code>ClienteController.java</code> se encarga de gestionar las peticiones HTTP GET. Su función principal es decidir qué vista mostrar al usuario según la acción solicitada en la URL.</p>

	  <h3>📌 Propósito general</h3>
	  <ul>
		<li>Mostrar el formulario de edición o inserción de clientes.</li>
		<li>Listar todos los clientes registrados.</li>
		<li>Eliminar un cliente específico.</li>
	  </ul>

	  <h3>🧩 Estructura del método</h3>
	  <pre><code>protected void doGet(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		String action = request.getParameter("action");
		String urlVista = "";

		switch (action) {
			case "borrar":
				// Eliminar cliente
				break;
			case "editar":
				// Cargar cliente para edición
				break;
			case "listado":
				// Mostrar listado de clientes
				break;
			default:
				// Mostrar formulario vacío
		}

		RequestDispatcher vista = request.getRequestDispatcher(urlVista);
		vista.forward(request, response);
	}</code></pre>

	  <h3>🔍 Detalle de cada caso</h3>

	  <h4>🗑️ <code>borrar</code></h4>
	  <ul>
		<li>Obtiene el <code>clienteId</code> desde la URL.</li>
		<li>Llama a <code>dao.borrarCliente(clienteId)</code> para eliminarlo.</li>
		<li>Actualiza la lista de clientes y redirige a <code>listadoClientes.jsp</code>.</li>
	  </ul>

	  <h4>✏️ <code>editar</code></h4>
	  <ul>
		<li>Obtiene el cliente por su ID.</li>
		<li>Envía el objeto <code>Cliente</code> como atributo a <code>cliente.jsp</code>.</li>
		<li>La vista mostrará el formulario con los datos precargados.</li>
	  </ul>

	  <h4>📋 <code>listado</code></h4>
	  <ul>
		<li>Obtiene todos los clientes desde el DAO.</li>
		<li>Redirige a la vista <code>listadoClientes.jsp</code>.</li>
	  </ul>

	  <h4>➕ <code>default</code></h4>
	  <ul>
		<li>Si no se especifica ninguna acción, se muestra el formulario vacío para insertar un nuevo cliente.</li>
	  </ul>

	  <h3>🚀 Despacho de la vista</h3>
	  <p>Se utiliza <code>RequestDispatcher</code> para redirigir la petición a la vista correspondiente sin cambiar la URL del navegador:</p>
	  <pre><code>RequestDispatcher vista = request.getRequestDispatcher(urlVista);
	vista.forward(request, response);</code></pre>

	  <h3>🧠 Conceptos clave</h3>
	  <ul>
		<li><strong>Controlador MVC:</strong> Este método actúa como el controlador que decide qué vista mostrar y qué datos enviar.</li>
		<li><strong>Separación de responsabilidades:</strong> No contiene lógica de negocio ni presentación, solo coordinación.</li>
		<li><strong>Reutilización de vistas:</strong> Tanto inserción como edición usan la misma vista <code>cliente.jsp</code>.</li>
	  </ul>
	</div>
</div>

<div class="box">
    <button class="button is-info is-light" onclick="toggleSection('metodo-post')">📨 Explicación detallada del método <code>doPost</code></button>
	<div id="metodo-post" class="content is-hidden mt-3">
	  <p>El método <code>doPost</code> se encarga de procesar los datos enviados desde el formulario HTML mediante una petición HTTP POST. En este ejemplo, se utiliza para insertar un nuevo cliente o actualizar uno existente.</p>

	  <h3>📌 Propósito general</h3>
	  <ul>
		<li>Recoger los datos del formulario enviado por el usuario.</li>
		<li>Convertir los datos en un objeto <code>Cliente</code>.</li>
		<li>Insertar o actualizar el cliente en la base de datos.</li>
		<li>Redirigir a la vista de listado de clientes.</li>
	  </ul>

	  <h3>🧩 Estructura del método</h3>
	  <pre><code>protected void doPost(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		request.setCharacterEncoding("ISO-8859-1");

		String strClienteId = request.getParameter("clienteId");
		String strNombre = request.getParameter("nombre");
		String strApellidos = request.getParameter("apellidos");
		String strFechaNacimiento = request.getParameter("fechaNacimiento");
		String strNumPedido = request.getParameter("numPedidos");

		try {
			Cliente cliente = new Cliente();
			cliente.setNombre(strNombre);
			cliente.setApellidos(strApellidos);
			Date fecha = new SimpleDateFormat("dd/MM/yyyy").parse(strFechaNacimiento);
			cliente.setFechaNacimiento(fecha);
			cliente.setNumPedidos(Integer.parseInt(strNumPedido));

			if (strClienteId == null || strClienteId.isEmpty()) {
				dao.insertarCliente(cliente);
			} else {
				cliente.setId(Integer.parseInt(strClienteId));
				dao.actualizarCliente(cliente);
			}
		} catch (ParseException e) {
			e.printStackTrace();
		}

		request.setAttribute("clientes", dao.obtenerClientes());
		RequestDispatcher vista = request.getRequestDispatcher(LISTADO);
		vista.forward(request, response);
	}</code></pre>

	  <h3>🔍 Paso a paso</h3>

	  <h4>🔤 Codificación de caracteres</h4>
	  <p>Se establece <code>ISO-8859-1</code> para evitar problemas con caracteres especiales como tildes o eñes.</p>

	  <h4>📥 Lectura de parámetros</h4>
	  <ul>
		<li>Se extraen los valores del formulario usando <code>request.getParameter()</code>.</li>
		<li>Los datos incluyen nombre, apellidos, fecha de nacimiento, número de pedidos y (opcionalmente) el ID del cliente.</li>
	  </ul>

	  <h4>🧱 Construcción del objeto <code>Cliente</code></h4>
	  <ul>
		<li>Se crea una instancia de <code>Cliente</code>.</li>
		<li>Se asignan los valores obtenidos del formulario.</li>
		<li>La fecha se convierte usando <code>SimpleDateFormat</code>.</li>
	  </ul>

	  <h4>🔄 Inserción o actualización</h4>
	  <ul>
		<li>Si el campo <code>clienteId</code> está vacío, se inserta un nuevo cliente.</li>
		<li>Si contiene un valor, se actualiza el cliente existente con ese ID.</li>
	  </ul>

	  <h4>📋 Redirección a la vista</h4>
	  <ul>
		<li>Se actualiza la lista de clientes.</li>
		<li>Se redirige a <code>listadoClientes.jsp</code> usando <code>RequestDispatcher</code>.</li>
	  </ul>

	  <h3>🧠 Conceptos clave</h3>
	  <ul>
		<li><strong>Validación básica:</strong> Se verifica si el ID está vacío para decidir entre insertar o actualizar.</li>
		<li><strong>Conversión de tipos:</strong> Se convierte la fecha y el número de pedidos a sus tipos correspondientes.</li>
		<li><strong>Control de errores:</strong> Se captura <code>ParseException</code> por si la fecha no tiene el formato esperado.</li>
		<li><strong>Reutilización de vistas:</strong> Tanto inserción como edición redirigen al listado final.</li>
	  </ul>
	</div>
</div>


<div class="box">
  <button class="button is-info is-light" onclick="toggleSection('conceptos')">🔗 Conceptos de programación aplicados</button>
	<div id="conceptos" class="content is-hidden mt-3">
	  <h3>1. 🧱 Programación orientada a objetos (POO)</h3>
	  <ul>
		<li><strong>Encapsulamiento:</strong> El objeto <code>Cliente</code> agrupa atributos y métodos relacionados.</li>
		<li><strong>Abstracción:</strong> El controlador usa <code>ClienteDao</code> sin conocer su implementación interna.</li>
		<li><strong>Modularidad:</strong> Cada clase tiene una responsabilidad clara y separada.</li>
	  </ul>

	  <h3>2. 🔁 Patrón MVC (Modelo-Vista-Controlador)</h3>
	  <ul>
		<li><strong>Modelo:</strong> <code>Cliente.java</code> representa los datos del cliente.</li>
		<li><strong>Vista:</strong> <code>cliente.jsp</code> y <code>listadoClientes.jsp</code> muestran la interfaz al usuario.</li>
		<li><strong>Controlador:</strong> <code>ClienteController.java</code> gestiona el flujo entre modelo y vista.</li>
	  </ul>

	  <h3>3. 🧠 Principios SOLID</h3>
	  <ul>
		<li><strong>S - Responsabilidad única:</strong> Cada clase tiene una única razón para cambiar.</li>
		<li><strong>D - Inversión de dependencias:</strong> Se puede aplicar inyección de dependencias para desacoplar componentes.</li>
	  </ul>

	  <h3>4. 🧮 Manejo de errores y validación</h3>
	  <ul>
		<li><strong>Control de errores:</strong> Uso de <code>try-catch</code> para capturar <code>ParseException</code>.</li>
		<li><strong>Validación:</strong> Verificación de campos como <code>clienteId</code> para decidir entre insertar o actualizar.</li>
	  </ul>

	  <h3>5. 🌐 Comunicación cliente-servidor</h3>
	  <ul>
		<li><strong>Servlet:</strong> Actúa como intermediario entre el navegador y el servidor.</li>
		<li><strong>HTTP:</strong> Manejo de métodos <code>GET</code> y <code>POST</code> para procesar peticiones.</li>
	  </ul>

	  <h3>6. 📦 Reutilización y mantenimiento</h3>
	  <ul>
		<li><strong>Constantes reutilizables:</strong> Como <code>INSERTAR_O_EDITAR</code> y <code>LISTADO</code> para rutas de vistas.</li>
		<li><strong>Separación de capas:</strong> Facilita pruebas unitarias y mantenimiento del código.</li>
	  </ul>
	</div>
  </div>
  
  <div class="box">
	<button class="button is-info is-light" onclick="toggleSection('tecnicos')">🧠 Detalles técnicos adicionales</button>
	<div id="tecnicos" class="content is-hidden mt-3">
		<ul>
		  <li><strong>Codificación:</strong> Se establece <code>ISO-8859-1</code> para evitar problemas con caracteres especiales.</li>
		  <li><strong>Control de errores:</strong> Se captura <code>ParseException</code> al convertir fechas.</li>
		  <li><strong>Validación:</strong> Se verifica si <code>clienteId</code> está vacío para decidir entre insertar o actualizar.</li>
		  <li><strong>Reutilización de vistas:</strong> Tanto inserción como edición usan la misma vista JSP.</li>
		</ul>
	</div>
  </div>

  <div class="box">
    	<button class="button is-info is-light" onclick="toggleSection('alternativas')">🌐 Alternativas en Java para desarrollo de aplicaciones web con MVC</button>
	<div id="alternativas" class="content is-hidden mt-3">
    <ul>
      <li><strong>Spring MVC:</strong> Framework moderno y ampliamente adoptado.</li>
      <li><strong>Struts:</strong> Clásico pero aún funcional en entornos legacy.</li>
      <li><strong>JSF:</strong> Ideal para aplicaciones empresariales con componentes reutilizables.</li>
      <li><strong>Vaadin:</strong> UI rica con Java puro, sin necesidad de HTML/CSS/JS.</li>
    </ul>
  </div>
    </div>
</div>
</section>
</body>
</html>
